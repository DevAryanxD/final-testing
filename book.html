<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Details - Classic Books Library</title>
    <meta name="description" content="Explore book details, reviews, and similar books at Classic Books Library.">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Poppins&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        h1, h2, h3 {
            font-family: 'Orbitron', sans-serif;
            color: #00b4d8;
            text-shadow: 0 0 10px #00b4d8, 0 0 20px #7209b7;
        }
        .nav-link {
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }
        .nav-link:hover {
            color: #00b4d8;
            text-shadow: 0 0 10px #00b4d8;
        }
        .hero-section {
            background: linear-gradient(135deg, #2a2a2a, #7209b7);
            padding: 2rem;
            border-radius: 8px;
            border: 1px solid #00b4d8;
            position: relative;
        }
        .book-cover {
            width: 100%;
            max-width: 300px;
            height: auto;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 0 15px #00b4d8;
        }
        .btn-glow {
            background: linear-gradient(90deg, #00b4d8, #7209b7);
            transition: box-shadow 0.3s ease;
        }
        .btn-glow:hover {
            box-shadow: 0 0 15px #00b4d8;
        }
        .favorite-btn {
            transition: color 0.3s ease, transform 0.3s ease;
        }
        .favorite-btn.favorited {
            color: #ff4d4d;
            transform: scale(1.2);
        }
        .book-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
            border: 1px solid #00b4d8;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 450px;
            flex: 0 0 200px;
        }
        .book-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #00b4d8, 0 0 30px #7209b7;
        }
        .book-card img {
            width: 100%;
            height: 250px;
            object-fit: contain;
            border-radius: 8px;
            padding-top: 3px;
        }
        .book-card .content {
            padding: 1rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .book-card h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .book-card p {
            font-size: 0.875rem;
            color: #a0a0a0;
            margin-bottom: 0.5rem;
            flex-grow: 1;
        }
        .book-card a {
            background: linear-gradient(90deg, #00b4d8, #7209b7);
            color: #fff;
            padding: 0.5rem;
            border-radius: 8px;
            text-align: center;
            transition: box-shadow 0.3s ease;
        }
        .book-card a:hover {
            box-shadow: 0 0 15px #00b4d8;
        }
        .book-scroll-container {
            display: flex;
            overflow-x: auto;
            gap: 16px;
            padding-bottom: 16px;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }
        .book-scroll-container::-webkit-scrollbar {
            height: 8px;
        }
        .book-scroll-container::-webkit-scrollbar-thumb {
            background: #00b4d8;
            border-radius: 4px;
        }
        .book-scroll-container::-webkit-scrollbar-track {
            background: #2a2a2a;
        }
        .review-card {
            background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
            border: 1px solid #00b4d8;
            border-radius: 8px;
        }
        .review-card img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 1rem;
        }
        .star-rating {
            color: #d1d5db;
            cursor: pointer;
        }
        .star-rating .star {
            font-size: 1.5rem;
            transition: color 0.3s ease;
        }
        .star-rating .star:hover,
        .star-rating .star.filled {
            color: #facc15;
        }
        .share-icons {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
        }
        .share-btn {
            transition: background 0.3s ease;
            padding: 0.5rem;
            border-radius: 8px;
        }
        .share-btn:hover {
            background: #00b4d8;
        }
        .stats-section {
            background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
            border: 1px solid #00b4d8;
            border-radius: 8px;
            padding: 1rem;
        }
        .download-section {
            background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
            border: 1px solid #00b4d8;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
        }
        .download-btn {
            background: linear-gradient(90deg, #00b4d8, #7209b7);
            color: #fff;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.25rem;
            margin: 0.5rem 0;
            display: block;
            transition: box-shadow 0.3s ease;
        }
        .download-btn:hover {
            box-shadow: 0 0 15px #00b4d8;
        }
        .rate-section {
            background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
            border: 1px solid #00b4d8;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="bg-gradient-to-r from-gray-900 to-purple-900 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-bold">Classic Books Library</h1>
            <div class="space-x-6">
                <a href="index.html" class="nav-link">Home</a>
                <a href="about.html" class="nav-link">About</a>
                <a href="index.html#contact" class="nav-link">Contact</a>
                <a href="donate.html" class="nav-link">Donate</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section: Book Details -->
    <section class="container mx-auto py-8">
        <div class="hero-section flex flex-col md:flex-row items-center gap-8">
            <img id="book-cover" src="" alt="Book Cover" class="book-cover" loading="lazy">
            <div class="flex-1">
                <div class="share-icons">
                    <button class="share-btn bg-pink-600 text-white" onclick="shareBook('instagram')"><i class="fab fa-instagram"></i></button>
                    <button class="share-btn bg-green-600 text-white" onclick="shareBook('whatsapp')"><i class="fab fa-whatsapp"></i></button>
                    <button class="share-btn bg-blue-600 text-white" onclick="shareBook('twitter')"><i class="fab fa-twitter"></i></button>
                    <button class="share-btn bg-gray-600 text-white" onclick="shareBook('copy')"><i class="fas fa-link"></i></button>
                </div>
                <h2 id="book-title" class="text-3xl font-bold mb-4">Book Title</h2>
                <p id="book-author" class="text-sm text-gray-300 mb-2">Author Name</p>
                <p id="book-genre" class="text-sm text-gray-300 mb-2">Genre: Unknown</p>
                <p id="book-rating" class="text-sm text-gray-300 mb-4">Rating: 0/5</p>
                <p id="book-description" class="text-sm mb-4">Book description goes here.</p>
                <div class="flex gap-4">
                    <a id="read-now-btn" href="#" class="btn-glow text-white p-3 rounded-lg">Read Now</a>
                    <button id="favorite-btn" class="favorite-btn text-white p-3 rounded-lg"><i class="fas fa-heart text-2xl"></i></button>
                </div>
            </div>
        </div>
    </section>

    <!-- Book Stats -->
    <section class="container mx-auto py-4">
        <div class="stats-section">
            <p id="book-stats" class="text-sm text-gray-300">Pages: Unknown | Published: Unknown | Avg. Rating: Unknown</p>
        </div>
    </section>

    <!-- Download Section -->
    <section class="container mx-auto py-8">
        <h2 class="text-2xl font-bold mb-4 text-center">Download This Book</h2>
        <div class="download-section">
            <div id="download-links" class="flex flex-col gap-4">
                <!-- Download buttons will be dynamically added here -->
            </div>
        </div>
    </section>

    <!-- Rate This Book -->
    <section class="container mx-auto py-8">
        <div class="rate-section">
            <h2 class="text-2xl font-bold mb-4">Rate This Book</h2>
            <div class="star-rating mb-4">
                <i class="fas fa-star star" data-value="1"></i>
                <i class="fas fa-star star" data-value="2"></i>
                <i class="fas fa-star star" data-value="3"></i>
                <i class="fas fa-star star" data-value="4"></i>
                <i class="fas fa-star star" data-value="5"></i>
            </div>
            <p id="rating-message" class="text-sm text-gray-300">Click the stars to rate this book!</p>
        </div>
    </section>

    <!-- Reader Reviews -->
    <section class="container mx-auto py-8">
        <h2 class="text-2xl font-bold mb-4">Reader Reviews</h2>
        <div id="reviews" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
            <!-- Reviews will be dynamically added here -->
        </div>
    </section>

    <!-- Similar Books -->
    <section class="container mx-auto py-8">
        <h2 class="text-2xl font-bold mb-4">Similar Books</h2>
        <div id="similar-books" class="book-scroll-container">
            <!-- Similar books will be dynamically added here -->
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-gray-900 to-purple-900 text-white p-4 text-center">
        <p>© 2025 Classic Books Library. All rights reserved.</p>
    </footer>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const bookTitle = decodeURIComponent(urlParams.get('title'));

        document.title = `${bookTitle} - Classic Books Library`;
        document.querySelector('meta[name="description"]').setAttribute('content', `Explore details of ${bookTitle} at Classic Books Library.`);

        fetch('books.json')
            .then(response => response.json())
            .then(books => {
                const book = books.find(b => b.title === bookTitle);
                if (book) {
                    // Update Book Details
                    document.getElementById('book-cover').src = book.cover;
                    document.getElementById('book-title').textContent = book.title;
                    document.getElementById('book-author').textContent = book.author;
                    document.getElementById('book-rating').textContent = `Rating: 4.5/5`; // Sample rating
                    document.getElementById('book-description').textContent = book.description;
                    document.getElementById('read-now-btn').href = `book.html?title=${encodeURIComponent(book.title)}`;

                    // Update Stats (Sample data for now)
                    document.getElementById('book-stats').textContent = `Pages: 300 | Published: 2004 | Avg. Rating: 4.5/5`;

                    // Update Download Links
                    const downloadLinksContainer = document.getElementById('download-links');
                    if (book.downloads && book.downloads.length > 0) {
                        book.downloads.forEach(download => {
                            downloadLinksContainer.innerHTML += `
                                <a href="${download.link}" class="download-btn">${download.label}</a>`;
                        });
                    } else {
                        downloadLinksContainer.innerHTML = '<p class="text-sm text-gray-300">No downloads available.</p>';
                    }
                } else {
                    document.querySelector('.hero-section').innerHTML = '<p class="text-center text-gray-300">Book Not Found</p>';
                }
            })
            .catch(error => console.error('Error loading book data:', error));

        fetch('genres.json')
            .then(response => response.json())
            .then(genres => {
                let book = null;
                let genreNames = [];
                let similarBooks = [];

                // Find the book in genres.json and collect all genres it belongs to
                for (const genre of genres) {
                    for (const category of ['trending', 'most_read', 'new_releases', 'hidden_gems', 'classics']) {
                        const foundBook = genre[category].find(b => b.title === bookTitle);
                        if (foundBook) {
                            book = foundBook;
                            // Add the genre to the list if not already present
                            if (!genreNames.includes(genre.genre)) {
                                genreNames.push(genre.genre);
                            }
                            // Collect similar books from this genre (excluding the current book)
                            const similarFromGenre = genre[category].filter(b => b.title !== bookTitle);
                            similarBooks = [...similarBooks, ...similarFromGenre];
                        }
                    }
                }

                if (book) {
                    // Update Genre in Book Details
                    const genreElement = document.getElementById('book-genre');
                    if (genreNames.length > 0) {
                        genreElement.textContent = `Genre: ${genreNames.join(', ')}`;
                    } else {
                        genreElement.textContent = `Genre: Unknown`;
                    }

                    // Load Reviews (Using the first genre's reviews for now)
                    const reviewsContainer = document.getElementById('reviews');
                    const profilePics = [
                        'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=40&q=80',
                        'https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-4.0.3&auto=format&fit=crop&w=40&q=80',
                        'https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?ixlib=rb-4.0.3&auto=format&fit=crop&w=40&q=80'
                    ];
                    const firstGenre = genres.find(g => g.genre === genreNames[0]);
                    if (firstGenre && firstGenre.reviews) {
                        firstGenre.reviews.forEach((review, index) => {
                            reviewsContainer.innerHTML += `
                                <div class="review-card p-4 rounded-lg flex items-start">
                                    <img src="${profilePics[index]}" alt="User Avatar" loading="lazy">
                                    <div>
                                        <p class="text-sm text-gray-300">"${review.text}"</p>
                                        <p class="text-sm text-cyan-500 mt-2">- ${review.author}, ${review.rating}</p>
                                    </div>
                                </div>`;
                        });
                    }

                    // Load Similar Books (Remove duplicates and limit to 5)
                    const uniqueSimilarBooks = [];
                    const seenTitles = new Set();
                    for (const similarBook of similarBooks) {
                        if (!seenTitles.has(similarBook.title)) {
                            seenTitles.add(similarBook.title);
                            uniqueSimilarBooks.push(similarBook);
                        }
                    }
                    const similarBooksContainer = document.getElementById('similar-books');
                    uniqueSimilarBooks.slice(0, 5).forEach(similarBook => {
                        similarBooksContainer.innerHTML += `
                            <div class="book-card">
                                <img src="${similarBook.cover}" alt="${similarBook.title} Cover" loading="lazy">
                                <div class="content">
                                    <h3>${similarBook.title}</h3>
                                    <p class="text-gray-400">${similarBook.author}</p>
                                    <p>${similarBook.description}</p>
                                    <a href="book.html?title=${encodeURIComponent(similarBook.title)}">Read Now</a>
                                </div>
                            </div>`;
                    });
                }
            })
            .catch(error => console.error('Error loading genres data:', error));

        // Read Now Button Functionality
        document.getElementById('read-now-btn').addEventListener('click', (e) => {
            e.preventDefault();
            alert('Online Reader not available right now, please download the book to read Offline');
        });

        // Favorite Button Functionality
        const favoriteBtn = document.getElementById('favorite-btn');
        favoriteBtn.addEventListener('click', () => {
            favoriteBtn.classList.toggle('favorited');
        });

        // Star Rating Functionality
        const stars = document.querySelectorAll('.star-rating .star');
        const ratingMessage = document.getElementById('rating-message');
        stars.forEach(star => {
            star.addEventListener('mouseover', () => {
                const value = star.getAttribute('data-value');
                stars.forEach(s => {
                    if (s.getAttribute('data-value') <= value) {
                        s.classList.add('filled');
                    } else {
                        s.classList.remove('filled');
                    }
                });
            });
            star.addEventListener('mouseout', () => {
                stars.forEach(s => {
                    if (!s.classList.contains('rated')) {
                        s.classList.remove('filled');
                    }
                });
            });
            star.addEventListener('click', () => {
                const value = star.getAttribute('data-value');
                stars.forEach(s => {
                    if (s.getAttribute('data-value') <= value) {
                        s.classList.add('filled', 'rated');
                    } else {
                        s.classList.remove('filled', 'rated');
                    }
                });
                ratingMessage.textContent = `You rated this book ${value}/5!`;
            });
        });

        // Share Book Functionality
        function shareBook(platform) {
            const url = window.location.href;
            const title = encodeURIComponent(bookTitle);
            let shareUrl = '';
            switch (platform) {
                case 'instagram':
                    shareUrl = `https://www.instagram.com/?url=${url}`;
                    break;
                case 'whatsapp':
                    shareUrl = `https://api.whatsapp.com/send?text=Check out this book: ${title} ${url}`;
                    break;
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?text=Check out this book: ${title}&url=${url}`;
                    break;
                case 'copy':
                    navigator.clipboard.writeText(url);
                    alert('Link copied to clipboard!');
                    return;
            }
            window.open(shareUrl, '_blank');
        }

        // Smooth scroll and redirect for Contact link
        document.querySelector('a[href="index.html#contact"]').addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = 'index.html#contact';
        });
    </script>
</body>
</html>